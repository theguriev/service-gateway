# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Rate Limits

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–π—Ç –ª–∏–º–∏—Ç–æ–≤ –≤ service-gateway.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1. API —Ç–µ—Å—Ç—ã (`test-api/flow.test.ts`)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ä–∞–±–æ—Ç—É —Ä–µ–π—Ç –ª–∏–º–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å—ã:

```bash
pnpm test:api
```

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ—Å–ª–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞  
- ‚è∞ –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–∞ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞
- üåê –û—Ç–¥–µ–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤

### 2. Unit —Ç–µ—Å—Ç—ã (`test-unit/rate-limit.test.ts`)

–ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `checkRateLimit`:

```bash
pnpm test:unit
```

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö IP

### 3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã (`scripts/test-rate-limits.js`)

–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```bash
pnpm test:rate-limits
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞
- –ü–æ–∫–∞–∑ —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞ —á–µ—Ä–µ–∑ –≤—Ä–µ–º—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ IP —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

–í `routes.json` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```json
{
  "/test-rate-limit": {
    "methods": ["GET"],
    "rateLimit": {
      "requests": 3,
      "window": 10
    },
    "proxy": { "to": "http://localhost:3000" }
  },
  "/test-rate-limit-strict": {
    "methods": ["GET"], 
    "rateLimit": {
      "requests": 1,
      "window": 5
    },
    "proxy": { "to": "http://localhost:3000" }
  }
}
```

## –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pnpm test

# –¢–æ–ª—å–∫–æ API —Ç–µ—Å—Ç—ã
pnpm test:api

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã  
pnpm test:unit

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
pnpm dev & # –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
pnpm test:rate-limits
```

## –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤

### –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```json
{
  "success": true
}
```

### –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
```json
{
  "message": "Rate limit exceeded",
  "statusCode": 429,
  "statusMessage": "Too Many Requests"
}
```

## –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- ‚úÖ –û—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É —Ä–µ–π—Ç –ª–∏–º–∏—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –∏ —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—é –º–µ–∂–¥—É IP –∞–¥—Ä–µ—Å–∞–º–∏
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (–Ω—É–ª–µ–≤–æ–µ –æ–∫–Ω–æ, –±–æ–ª—å—à–∏–µ –ª–∏–º–∏—Ç—ã)
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ X-Forwarded-For –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ IP

## –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ –±–ª–∞–≥–æ–¥–∞—Ä—è:
- In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â—É –¥–ª—è —Ä–µ–π—Ç –ª–∏–º–∏—Ç–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –Ω–∞–∫–ª–∞–¥–Ω—ã–º —Ä–∞—Å—Ö–æ–¥–∞–º –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å